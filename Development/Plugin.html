<!DOCTYPE html>
<html>
<head>
	<meta name="author" content="Daiki Umeda (XJINE)">
	<meta name="generator" content="Blackboard">
	<meta name="generator" content="KARAS">
	<meta charset="UTF-8" />
	<title>KARAS - Plugin</title>
	<link rel="stylesheet" href="../default.css" type="text/css" media="all" charset="">
	<meta property="og:site_name" content="KARAS">
	<meta property="og:title" content="Plugin">
	<meta property="og:url" content="http://www.lightweightmarkuplanguage.com/Development/Plugin.html">
	<meta property="og:image" content="http://www.lightweightmarkuplanguage.com/ogpimg.jpg">
	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
	  ga('create', 'UA-44157178-2', 'lightweightmarkuplanguage.com');
	  ga('send', 'pageview');
	</script>
</head>
<body>
<div id="outframe">
	<header>
		<a id="logo" href="../index.html" title="Top"></a>
		<h1><a href="../index.html">KARAS</a></h1>
		<h2><a href="../index.html">Lightweight Markup Language</a></h2>
	</header>
	<div id="contents">
		<div id="sidebar">
			<ul class="menu">
				<li><a href="./../Syntax/index.html" title="Syntax">Syntax</a></li>
				<li><a href="./../Download.html" title="Download">Download</a></li>
				<li><a href="./../License.html" title="License">License</a></li>
				<li><a href="./../Development/index.html" title="Development">Development</a></li>
				<li><a href="./../Donation.html" title="Donation">Donation</a></li>
				<li><a href="./../Information.html" title="Donation">Information</a></li>
			</ul>
			<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
			<!-- KARAS_Side_160x600 -->
			<ins class="adsbygoogle"
			     style="display:inline-block;width:160px;height:600px"
			     data-ad-client="ca-pub-9133526697051515"
			     data-ad-slot="6825762586"></ins>
			<script>
			(adsbygoogle = window.adsbygoogle || []).push({});
			</script>
		</div>
		<div id="maincolumn">
			<div id="pageinfo">
				<div id ="topicpath"><a href="../index.html">Top</a>&nbsp;&gt;&nbsp;<a href="../Development/index.html">Development</a>&nbsp;&gt;&nbsp;<a href="Plugin.html">Plugin</a></div>
				<div id="lastmodified">Last modified : 2014. 04. 28</div>
			</div>
			<article>
			<h1 id="plugin">Plugin</h1>
<p>ここではプラグイン (Plugin Syntax) の開発について解説します。</p>
<ul>
<li><a href="#directoryfile">ディレクトリとファイル</a></li>
<li><a href="#pluginsyntax">Plugin Syntax</a></li>
<li><a href="#developplugin">プラグインの実装方法</a></li>
<li><a href="#convertplugin">Convert type Plugin</a></li>
<li><a href="#actionplugin">Action type Plugin</a></li>
<li><a href="#othertips">Other tips</a>
<ul>
<li><a href="#psyntaxmars">Plugin Syntax 内の [[ と ]]</a></li>
<li><a href="#tofastconvert">高速な変換のために</a></li>
</ul>
</li>
</ul>
<h2 id="directoryfile">ディレクトリとファイル</h2>
<p>プラグインディレクトリの名前には <em>plugins</em> を推奨しています。また、プラグインディレクトリは、KARAS の実行ファイルと同じ階層に置くことを推奨しています。ただし、あなたの KARAS を導入するシステムが持つ既存の設定がこれらと衝突する場合には、変更しても良いです。標準のコンバータでは、ディレクトリ名とそのパスを変更する場合は、ソースコードを修正する必要があります。</p>
<p>プラグインのファイル名は、そのプラグイン本体が持つ、class あるいは module などの名前と、等しくなるようにしてください。ファイル名は大文字と小文字を考慮します。例えば、名前が <em>Sample</em> というプラグインは、<em>Sample.ext</em> というファイル名にしてください。このとき、class あるいは module の名前は、<em>Sample</em> となります。あなたの KARAS を導入するシステムがこの命名規則によって問題を持つときは変更しても良いです。標準のコンバータでは、命名規則を変更する場合は、ソースコードを修正する必要があります。</p>
<div class="note">
<p>ただし、Javascript ver. の名前空間はこの限りではありません。アルゴリズムが複雑化することを避けるため、名前空間は小文字で定義されます。詳細は、Javascript ver. のプラグインのソースコードを読んでください。</p>
</div>
<h2 id="pluginsyntax">Plugin Syntax</h2>
<p>KARAS では、Plugin の構文は、次のように定められています。</p>
<figure>
<figcaption>Convert type plugin (Level1)</figcaption>
<pre class="karas"><code class="karas">[[ PluginName :: option1 :: option2... :: markedupText]]</code></pre>
</figure>
<figure>
<figcaption>Action type plugin (Level2)</figcaption>
<pre class="karas"><code class="karas">[[[ PluginName :: option1 :: option2...]]]</code></pre>
</figure>
<ul>
<li>構文に含まれる <strong>PluginName は大文字と小文字を考慮してはいけません。</strong>大文字の場合も小文字の場合も、同じプラグインが呼び出されるようにしてください。</li>
<li>オプションは必ず <code>::</code> で区切ってください。 <i>,</i> などを使って区切ることは推奨しません。</li>
<li>処理内容を変更するために <code>option1 - optionX</code> に与える文字列は、大文字か小文字かを考慮してはいけません。
<ul>
<li>例えば、<code>true</code> / <code>false</code> を指定するとき、<code>TRUE</code> / <code>FALSE</code> でも同じ結果が得られなければいけません。</li>
</ul>
</li>
<li>パラメータではない、マークアップされたテキストを引数にするときは、最後の引数に指定するようにしなければいけません。</li>
</ul>
<h2 id="developplugin">プラグインの実装方法</h2>
<p>標準のコンバータでは、プラグインは、KARAS のあらゆる構文が変換される前に変換されます。KARAS 以外の構文が、プラグインの中で書かれることがあるためです。例えば LaTeX などです。多くのシステムは、このような実装になると思いますが、もしも必要なら、プラグインを変換する順序を変更しても良いです。</p>
<p>Plugin Syntax を実装するとき、その実装方法はどのようにしても良いです。Plugin Syntax のフォーマットだけを守る必要があります。KARAS が導入されるシステムによって、プラグインの実装形態は変わるでしょう。</p>
<h2 id="convertplugin">Convert type Plugin</h2>
<p>Convert type Plugin は、あるマークアップされたテキストから新しいテキストを出力するためのプラグインです。</p>
<figure>
<figcaption>Syntax</figcaption>
<pre class="karas"><code class="karas">[[PluginName::markedupText :: options0 :: options1 :: ･･･]]</code></pre>
</figure>
<figure>
<figcaption>Implement</figcaption>
<pre class="csharp"><code class="csharp">public static Convert(markedupText, options)
return string</code></pre>
</figure>
<p>引数 <i>markedupText</i> は、Plugin Syntax でマークアップされた文字列型のテキストです。引数 <i>options</i> は、Plugin Syntax でマークアップされた文字列型の配列です。したがって、例えば、値型などのオプションを指定するときは、プラグイン内で値型に変換する必要があります。戻り値は、マークアップされたテキストを置き換える、文字列型の、新しいテキストです。</p>
<h2 id="actionplugin">Action type Plugin</h2>
<p>Action type Plugin は、テキスト全体を使って新しいテキストを出力するためのプラグインです。例えば、テキストに含まれる見出しをすべて探して、一覧にするようなプラグインを作ることができます。</p>
<figure>
<figcaption>Syntax</figcaption>
<pre class="karas"><code class="karas">[[[PluginName::options0 :: options1 :: ･･･]]]</code></pre>
</figure>
<figure>
<figcaption>Implement</figcaption>
<pre class="csharp"><code class="csharp">public static string Action(text, options)
return string</code></pre>
</figure>
<p>引数 <i>text</i> は、Action type Plugin が書かれたテキストが含まれるすべての文字列です。引数 <i>options</i> は、Plugin Syntax でマークアップされた文字列型の配列です。したがって、例えば、値型などのオプションを指定するときは、プラグイン内で値型に変換する必要があります。戻り値は、マークアップされたテキストを置き換える、文字列型の、新しいテキストです。</p>
<h2 id="othertips">Other tips</h2>
<h3 id="psyntaxmars">Plugin Syntax 内の [[ と ]]</h3>
<p>Plugin Syntax の中に、Plugin Syntax ではない <kbd>[[</kbd> や <kbd>]]</kbd> 記号を書くことはできません。これは、解決不可能な問題です。この問題を解決するためには、Plugin Syntax 内の <kbd>[[</kbd> や <kbd>]]</kbd> 記号を <code>\</code> を用いてエスケープすることが考えられます。あるいは、プラグインが持つ他の方法によって、エスケープしてください。</p>
<h3 id="tofastconvert">高速な変換のために</h3>
<p>高速な変換が必要なとき、プラグインはあらかじめコンパイルされていることが重要です。例えば Wiki のようなシステムでプラグインを利用するとき、システムの起動時に1度だけコンパイルするのは良い方法です。あるいは、変換した HTML をキャッシュすることが考えられます。</p>
<p>C# や Java などの言語は、実行時のコンパイルがとても遅いです。コンパイル済みのプラグインを利用することが考えられます。ただし、それを利用するときは注意が必要です。コンパイル済みのプラグインはソースコードが読めません。したがって、あなた以外のユーザが開発したコンパイル済みのプラグインを利用するとき、悪質なコードが出力結果に入れられる可能性があります。</p>
<p>この問題を解決するには、プラグインのソースコードを公開し、ユーザによってコンパイルされる必要があります。開発者は、公開方法についても注意する必要があります。</p>
			</article>
			<footer>
<p><small><a href="http://www.lightweightmarkuplanguage.com">&copy; KARAS - Lightweight Markup Language</a></small></p>
			</footer>
		</div>
	</div>
</div>
</body>
</html>